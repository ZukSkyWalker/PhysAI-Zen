<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>{% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{% else %}{{ site.title | escape }}{% endif %}</title>
  <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
  
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
  <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
  
  <!-- MathJax for LaTeX support -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  
  <!-- Syntax highlighting - Dark theme -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  
  <!-- Mermaid for flowcharts -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    // Convert code blocks with language-mermaid to mermaid divs
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('pre code.language-mermaid').forEach(function(code) {
        const pre = code.parentElement;
        const div = document.createElement('div');
        div.className = 'mermaid';
        div.textContent = code.textContent;
        pre.parentElement.replaceChild(div, pre);
      });
      
      // Initialize Mermaid
      mermaid.initialize({ 
        startOnLoad: true,
        theme: 'dark',
        themeVariables: {
          primaryColor: '#4a9eff',
          primaryTextColor: '#e8e6e3',
          primaryBorderColor: '#4a9eff',
          lineColor: '#00d4ff',
          secondaryColor: '#1a1a1a',
          tertiaryColor: '#2a2a2a',
          background: '#0a0a0a',
          mainBkg: '#1a1a1a',
          secondBkg: '#2a2a2a',
          textColor: '#e8e6e3',
          border1: '#4a9eff',
          border2: '#00d4ff',
          fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif'
        }
      });
    });
  </script>
</head>

<body>
  <header class="site-header">
    <div class="wrapper">
      <a class="site-title" href="{{ '/' | relative_url }}">{{ site.title | escape }}</a>
      <nav class="site-nav">
        <a href="{{ '/' | relative_url }}">Home</a>
        <a href="https://github.com/{{ site.github_username }}" target="_blank">GitHub</a>
        
        <!-- Music Control -->
        <div class="music-control-inline">
          <button class="music-icon-btn" id="music-toggle" title="Toggle Music">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
            </svg>
          </button>
          <input type="range" id="volume-control" min="0" max="100" value="30" class="volume-inline" title="Volume">
        </div>
      </nav>
    </div>
  </header>

  <main class="page-content">
    <div class="wrapper">
      {{ content }}
    </div>
  </main>

  <footer class="site-footer">
    <div class="wrapper">
      <p>{{ site.description }}</p>
      <p>&copy; {{ 'now' | date: "%Y" }} {{ site.author }}. All rights reserved.</p>
      <p style="font-size: 12px; margin-top: 10px; color: #4a9eff;">May the Force be with you. Always.</p>
    </div>
  </footer>

  <!-- Hidden YouTube Player -->
  <div id="youtube-player" style="display: none;"></div>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player;
    let isPlayerReady = false;
    
    // YouTube playlist ID
    const PLAYLIST_ID = 'PLOaXp3LQTM0L6AoDVomWhWa7S9YNMWGSv';
    const FIRST_VIDEO_ID = 'E-GX6Jful3k';
    let isPlaying = false;
    
    // Initialize YouTube Player
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('youtube-player', {
        height: '0',
        width: '0',
        videoId: FIRST_VIDEO_ID,
        playerVars: {
          'autoplay': 1,  // Auto-start
          'controls': 0,
          'disablekb': 1,
          'fs': 0,
          'modestbranding': 1,
          'playsinline': 1,
          'rel': 0,
          'showinfo': 0,
          'iv_load_policy': 3,
          'list': PLAYLIST_ID,
          'loop': 1
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }
    
    function onPlayerReady(event) {
      isPlayerReady = true;
      const savedVolume = localStorage.getItem('musicVolume') || '30';
      player.setVolume(parseInt(savedVolume));
      player.playVideo(); // Start playing
      isPlaying = true;
      updateMusicIcon();
    }
    
    function onPlayerStateChange(event) {
      if (event.data == YT.PlayerState.PLAYING) {
        isPlaying = true;
      } else if (event.data == YT.PlayerState.PAUSED) {
        isPlaying = false;
      }
      updateMusicIcon();
    }
    
    function updateMusicIcon() {
      const musicBtn = document.getElementById('music-toggle');
      if (musicBtn) {
        musicBtn.style.opacity = isPlaying ? '1' : '0.5';
      }
    }
    
    // UI Controls
    document.addEventListener('DOMContentLoaded', function() {
      const musicToggle = document.getElementById('music-toggle');
      const volumeControl = document.getElementById('volume-control');
      
      // Load saved volume
      const savedVolume = localStorage.getItem('musicVolume');
      if (savedVolume) {
        volumeControl.value = savedVolume;
      }
      
      // Toggle play/pause
      musicToggle.addEventListener('click', function() {
        if (!isPlayerReady) return;
        
        const state = player.getPlayerState();
        if (state === YT.PlayerState.PLAYING) {
          player.pauseVideo();
        } else {
          player.playVideo();
        }
      });
      
      // Volume control
      volumeControl.addEventListener('input', function() {
        if (isPlayerReady) {
          player.setVolume(this.value);
        }
      });
      
      // Save volume preference
      volumeControl.addEventListener('change', function() {
        localStorage.setItem('musicVolume', this.value);
      });
    });
  </script>
</body>
</html>

