<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>{% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{% else %}{{ site.title | escape }}{% endif %}</title>
  <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
  
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
  <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
  
  <!-- MathJax for LaTeX support -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  
  <!-- Syntax highlighting - Dark theme -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  
  <!-- Mermaid for flowcharts -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    // Convert code blocks with language-mermaid to mermaid divs
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('pre code.language-mermaid').forEach(function(code) {
        const pre = code.parentElement;
        const div = document.createElement('div');
        div.className = 'mermaid';
        div.textContent = code.textContent;
        pre.parentElement.replaceChild(div, pre);
      });
      
      // Initialize Mermaid
      mermaid.initialize({ 
        startOnLoad: true,
        theme: 'dark',
        themeVariables: {
          primaryColor: '#4a9eff',
          primaryTextColor: '#e8e6e3',
          primaryBorderColor: '#4a9eff',
          lineColor: '#00d4ff',
          secondaryColor: '#1a1a1a',
          tertiaryColor: '#2a2a2a',
          background: '#0a0a0a',
          mainBkg: '#1a1a1a',
          secondBkg: '#2a2a2a',
          textColor: '#e8e6e3',
          border1: '#4a9eff',
          border2: '#00d4ff',
          fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif'
        }
      });
    });
  </script>
</head>

<body>
  <header class="site-header">
    <div class="wrapper">
      <a class="site-title" href="{{ '/' | relative_url }}">{{ site.title | escape }}</a>
      <nav class="site-nav">
        <a href="{{ '/' | relative_url }}">Home</a>
        <a href="https://github.com/{{ site.github_username }}" target="_blank">GitHub</a>
      </nav>
    </div>
  </header>

  <main class="page-content">
    <div class="wrapper">
      {{ content }}
    </div>
  </main>

  <footer class="site-footer">
    <div class="wrapper">
      <p>{{ site.description }}</p>
      <p>&copy; {{ 'now' | date: "%Y" }} {{ site.author }}. All rights reserved.</p>
      <p style="font-size: 12px; margin-top: 10px; color: #4a9eff;">May the Force be with you. Always.</p>
    </div>
  </footer>

  <!-- Background Music Player -->
  <div id="music-player" class="music-player">
    <div class="music-player-toggle" id="player-toggle" title="Toggle Music Player">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
      </svg>
    </div>
    
    <div class="music-player-panel" id="player-panel">
      <div class="music-player-header">
        <span class="music-title">ðŸŽµ Background Music</span>
        <button class="music-close" id="close-panel" title="Close">Ã—</button>
      </div>
      
      <div class="music-controls">
        <button class="music-btn" id="play-pause" title="Play/Pause">
          <svg id="play-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
          <svg id="pause-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
            <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
          </svg>
        </button>
        
        <div class="volume-control">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
          </svg>
          <input type="range" id="volume-slider" min="0" max="100" value="30" class="volume-slider">
          <span id="volume-value" class="volume-value">30%</span>
        </div>
      </div>
      
      <div class="music-status" id="music-status">Ready to play</div>
    </div>
  </div>

  <!-- Hidden YouTube Player -->
  <div id="youtube-player" style="display: none;"></div>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player;
    let isPlayerReady = false;
    
    // YouTube playlist ID extracted from your link
    const PLAYLIST_ID = 'PLOaXp3LQTM0L6AoDVomWhWa7S9YNMWGSv';
    const FIRST_VIDEO_ID = 'E-GX6Jful3k';
    
    // Initialize YouTube Player
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('youtube-player', {
        height: '0',
        width: '0',
        videoId: FIRST_VIDEO_ID,
        playerVars: {
          'autoplay': 0,
          'controls': 0,
          'disablekb': 1,
          'fs': 0,
          'modestbranding': 1,
          'playsinline': 1,
          'rel': 0,
          'showinfo': 0,
          'iv_load_policy': 3,
          'list': PLAYLIST_ID,
          'loop': 1
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }
    
    function onPlayerReady(event) {
      isPlayerReady = true;
      player.setVolume(30); // Default volume 30%
      updateStatus('Ready to play');
    }
    
    function onPlayerStateChange(event) {
      const playIcon = document.getElementById('play-icon');
      const pauseIcon = document.getElementById('pause-icon');
      
      if (event.data == YT.PlayerState.PLAYING) {
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
        updateStatus('Playing...');
      } else if (event.data == YT.PlayerState.PAUSED) {
        playIcon.style.display = 'block';
        pauseIcon.style.display = 'none';
        updateStatus('Paused');
      } else if (event.data == YT.PlayerState.ENDED) {
        updateStatus('Ended');
      }
    }
    
    function updateStatus(text) {
      document.getElementById('music-status').textContent = text;
    }
    
    // UI Controls
    document.addEventListener('DOMContentLoaded', function() {
      const playerToggle = document.getElementById('player-toggle');
      const playerPanel = document.getElementById('player-panel');
      const closePanel = document.getElementById('close-panel');
      const playPauseBtn = document.getElementById('play-pause');
      const volumeSlider = document.getElementById('volume-slider');
      const volumeValue = document.getElementById('volume-value');
      
      // Toggle panel
      playerToggle.addEventListener('click', function() {
        playerPanel.classList.toggle('show');
      });
      
      closePanel.addEventListener('click', function() {
        playerPanel.classList.remove('show');
      });
      
      // Play/Pause
      playPauseBtn.addEventListener('click', function() {
        if (!isPlayerReady) {
          updateStatus('Player loading...');
          return;
        }
        
        const state = player.getPlayerState();
        if (state === YT.PlayerState.PLAYING) {
          player.pauseVideo();
        } else {
          player.playVideo();
        }
      });
      
      // Volume control
      volumeSlider.addEventListener('input', function() {
        const volume = this.value;
        volumeValue.textContent = volume + '%';
        if (isPlayerReady) {
          player.setVolume(volume);
        }
      });
      
      // Save volume preference
      volumeSlider.addEventListener('change', function() {
        localStorage.setItem('musicVolume', this.value);
      });
      
      // Load saved volume
      const savedVolume = localStorage.getItem('musicVolume');
      if (savedVolume) {
        volumeSlider.value = savedVolume;
        volumeValue.textContent = savedVolume + '%';
      }
    });
  </script>
</body>
</html>

